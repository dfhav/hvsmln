<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Strategic Full Funnel Allocator PRO</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:'Inter',Arial,sans-serif;background:linear-gradient(135deg,#0f172a,#1e293b);margin:0;padding:30px}
.container{max-width:1250px;margin:auto;background:#ffffff;padding:35px;border-radius:20px;box-shadow:0 25px 60px rgba(0,0,0,0.25)}
h1{margin:0 0 5px 0;font-size:26px}
.subtitle{color:#64748b;margin-bottom:25px}
.section-title{font-weight:600;margin-bottom:10px;font-size:13px;text-transform:uppercase;color:#475569}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:30px}
label{font-size:12px;font-weight:600;color:#334155;margin-top:10px;display:block}
select,input{width:100%;padding:9px;margin-top:5px;border-radius:8px;border:1px solid #cbd5e1;background:#f8fafc}
button{margin-top:20px;padding:12px;border:none;border-radius:10px;background:#0f172a;color:white;font-weight:600;cursor:pointer}
button:hover{background:#1e293b}
.info-btn{margin-left:8px;padding:2px 8px;border-radius:50%;background:#334155;color:white;font-size:11px;cursor:pointer}
.results{margin-top:35px;display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
.card{background:#f1f5f9;padding:18px;border-radius:16px;text-align:center}
.card h3{margin:0;font-size:13px;color:#475569}
.card p{font-size:20px;font-weight:700;margin:8px 0}
#chart{width:50% !important;max-width:400px;margin:auto;margin-top:30px}
.matrix{margin-top:35px;padding:20px;background:#eef2f7;border-radius:14px;font-size:14px}
.kpi-grid{margin-top:25px;display:grid;grid-template-columns:1fr;gap:20px}
.kpi-card{background:#f8fafc;padding:18px;border-radius:14px;text-align:center}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center}
.modal-content{background:white;padding:25px;border-radius:12px;max-width:500px}
.close{float:right;cursor:pointer;font-weight:bold}
.target-info{font-size:12px;color:#64748b;margin-top:3px}
</style>
</head>
<body>
<div class="container">
<h1>Strategic Full Funnel Allocator PRO</h1>
<p class="subtitle">Binet & Field | Share of Voice | KPI per Target</p>

<div class="grid">
<div>
<div class="section-title">Brand & Market Variables</div>
<label>Categoria</label>
<select id="category"><option>All categories</option><option>Automotive</option><option>FMCG</option><option>Finance</option><option>Retail Large</option><option>Retail Small</option><option>Telco</option><option>Travel</option></select>

<label>Market Type</label>
<select id="marketType"><option>Mass Market</option><option>Niche</option><option>Not Applicable</option></select>

<label>Market Size (€ milioni)</label>
<input type="number" id="marketSize" value="500">

<label>Target</label>
<select id="target" onchange="updateTargetInfo()"></select>
<div class="target-info" id="targetUniverse"></div>
</div>

<div>
<div class="section-title">Investment Strategy</div>
<label>Annual Media Spend (€ milioni)</label>
<input type="number" id="spend" value="20">
<label>Optimisation Time-frame</label>
<select id="timeframe"><option>Short term</option><option>Medium term</option><option>Long term</option></select>
<button onclick="calculate()">Run Simulation</button>
</div>
</div>

<div class="results" id="results"></div>
<canvas id="chart"></canvas>

<div class="matrix" id="matrix"></div>
<div class="kpi-grid" id="kpis"></div>
</div>

<div class="modal" id="modal"><div class="modal-content"><span class="close" onclick="closeModal()">X</span><div id="modalText"></div></div></div>

<script>
const targets={"Individui":52238950,"Adu 25-54":23383730,"Adu 18-34":10458850,"RA":25570960,"Adu 35-54":17034800,"Adu 25-64":31970760,"Adu Over64":13882540,"Adu Over18":49786916,"Adu 18-24":4010306,"Adu 25-34":6271725,"Adu 35-44":7491822,"Adu 35-64":25621840,"Adu 45-54":9510176,"Adu 55-64":8570061,"Adu Over35":39823304,"Adu 20-54":26374360,"Adu 18-64":35856000,"Donne 18-64":18067830,"GEN Z (14-29)":9463985,"Donne 18-34":5074900,"Donne 18-44":8835440,"Donne 18-54":13357340,"Donne 25-44":6670890,"Donne 25-54":11417750,"Uomini 18-64":18012860,"MILLENIALS (29-44)":11291260,"GEN X (45-60)":15122390,"BOOMERS (61-70)":10560170};

const targetSelect=document.getElementById("target");
for(let t in targets){let opt=document.createElement("option");opt.value=t;opt.text=t;targetSelect.appendChild(opt)}

function updateTargetInfo(){let t=document.getElementById("target").value;document.getElementById("targetUniverse").innerHTML="Universe: "+targets[t].toLocaleString()}
updateTargetInfo();

function calculate(){
let spend=parseFloat(document.getElementById("spend").value);
let marketSize=parseFloat(document.getElementById("marketSize").value);
let timeframe=document.getElementById("timeframe").value;

let upper=45,mid=30,lower=25;
if(timeframe==="Short term"){upper-=10;lower+=10}
if(timeframe==="Long term"){upper+=10;lower-=10}

let sat=Math.log(spend+1);
upper+=sat*2;lower-=sat*2;

let total=upper+mid+lower;
upper=Math.round((upper/total)*100);
mid=Math.round((mid/total)*100);
lower=100-upper-mid;

let sov=(spend/marketSize)*100;
let bfRatio=((upper+mid)/lower).toFixed(2);
let esov=(sov-10).toFixed(2);

results.innerHTML=`<div class="card"><h3>Upper (Brand)</h3><p>${upper}%</p></div><div class="card"><h3>Mid</h3><p>${mid}%</p></div><div class="card"><h3>Lower (Activation)</h3><p>${lower}%</p></div>`;
renderChart(upper,mid,lower);

matrix.innerHTML=`
<strong>Binet & Field Ratio</strong> ${bfRatio}:1 <span class="info-btn" onclick="openModal('bf')">i</span><br><br>
<strong>Share of Voice stimata</strong> ${sov.toFixed(2)}% <span class="info-btn" onclick="openModal('sov')">i</span><br><br>
<strong>Excess Share of Voice (ESOV)</strong> ${esov}% <span class="info-btn" onclick="openModal('esov')">i</span>`;

kpis.innerHTML=`<div class="kpi-card"><h3>Attention Index</h3><p>${(upper*0.8+mid*0.5+lower*0.3).toFixed(0)}</p></div>`;
}

function openModal(type){
let text="";
if(type==='bf')text="La Binet & Field Ratio misura l'equilibrio tra investimenti Brand (Upper+Mid) e Activation (Lower). Valori 60:40 o 2:1 sono tipici di strategie orientate alla crescita di lungo periodo.";
if(type==='sov')text="La Share of Voice indica la quota investimento del brand rispetto al totale mercato pubblicitario stimato.";
if(type==='esov')text="L'Excess Share of Voice rappresenta la differenza tra SOV e quota di mercato (SOM). ESOV positivo è correlato a crescita futura.";
document.getElementById('modalText').innerHTML=text;
document.getElementById('modal').style.display='flex';
}
function closeModal(){document.getElementById('modal').style.display='none'}

let chart;
function renderChart(u,m,l){const ctx=document.getElementById('chart');if(chart)chart.destroy();chart=new Chart(ctx,{type:'doughnut',data:{labels:['Upper','Mid','Lower'],datasets:[{data:[u,m,l],backgroundColor:['#0f172a','#334155','#94a3b8']}]} ,options:{plugins:{legend:{position:'bottom'}}}})}
</script>
</body>
</html>
